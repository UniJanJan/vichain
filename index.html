<!-- <!doctype html> -->
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Vichain</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body style="display: none;">
    <div id="app" class="container-fluid text-center d-flex flex-column" style="height: 100vh">
        <div class="row" style="text-align: initial;">
            <div class="col-12">
                <h2 style="margin-bottom: 0;">Vichain</h2>
                <span>Visual blockchain</span>
            </div>
        </div>
        <div class="row bg-light align-items-center justify-content-top"
            style="flex: 1 1 auto; min-height: 0; height: 100%;">
            <div class="col-9" id="visualisation-div" style="height: 100%; margin: 0;">
                <canvas id="visualisation-canvas" style="border-style: double; height: 100%; width: 100%;"></canvas>
            </div>
            <div class="col-3" style="align-self: start; max-height: 100%; overflow: scroll;">
                <div v-if="networkManager.selectedNode">
                    <h2>Node {{ networkManager.selectedNode.id }}</h2>
                    <nav>
                        <div class="nav nav-tabs" id="nav-tab" role="tablist">
                            <button class="nav-link active" id="nav-events-tab" data-bs-toggle="tab"
                                data-bs-target="#nav-events" type="button" role="tab" aria-controls="nav-events"
                                aria-selected="true">Events</button>
                            <button class="nav-link" id="nav-mempool-tab" data-bs-toggle="tab"
                                data-bs-target="#nav-mempool" type="button" role="tab" aria-controls="nav-mempool"
                                aria-selected="false">Mempool</button>
                            <button class="nav-link" id="nav-blockchain-tab" data-bs-toggle="tab"
                                data-bs-target="#nav-blockchain" type="button" role="tab" aria-controls="nav-blockchain"
                                aria-selected="false">Blockchain</button>
                        </div>
                    </nav>
                    <div class="tab-content" id="nav-tabContent">
                        <div class="tab-pane fade show active overflow-scroll" style="max-height: fit-content;"
                            id="nav-events" role="tabpanel" aria-labelledby="nav-events-tab">

                            Processable events
                            <div v-if="processableEvents.length > 0">
                                <ul class="list-group" v-for="event in processableEvents">
                                    <li class="list-group-item"
                                        :style="`font-size: small; padding: 0; background-color: ${networkManager.settings.events[event.constructor.name].color}; color: white;`">
                                        {{translateEventClassName(event)}} ({{ event.message ?
                                        event.message.constructor.name : '' }})</li>
                                </ul>
                            </div>
                            <div v-else>
                                <ul class="list-group">
                                    <li class="list-group-item" style="font-size: small; padding: 0;">Nothing in queue
                                    </li>
                                </ul>
                            </div>

                            Processing events
                            <div v-if="processingEvents.length > 0">
                                <ul class="list-group" v-for="event in processingEvents">
                                    <div>
                                        <li class="list-group-item"
                                            :style="`font-size: small; padding: 0; background-color: ${networkManager.settings.events[event.constructor.name].color}; color: white;`">
                                            {{translateEventClassName(event)}} ({{ event.message ?
                                            event.message.constructor.name : '' }})

                                        </li>
                                        <progress :value="event.progress" :max="event.duration"
                                            style="width: 99%; height: 3; margin-bottom: 5;"></progress>
                                    </div>
                                </ul>
                            </div>
                            <div v-else>
                                <ul class="list-group">
                                    <li class="list-group-item" style="font-size: small; padding: 0;">Nothing is
                                        processed</li>
                                </ul>
                            </div>

                            Processed events
                            <div v-if="processedEvents.length > 0">
                                <ul class="list-group" v-for="event in processedEvents">
                                    <li class="list-group-item"
                                        :style="`font-size: small; padding: 0; background-color: ${networkManager.settings.events[event.constructor.name].color}; color: white`">
                                        <span style="float: left; margin-left: 10;">{{translateEventClassName(event)}}
                                            ({{ event.message ? event.message.constructor.name : '' }})</span>
                                        <span class="badge bg-secondary"
                                            style="float: right; margin-right: 10;">{{event.processingEndTimestamp.toFixed(0)}}</span>
                                    </li>
                                </ul>
                            </div>
                            <div v-else>
                                <ul class="list-group">
                                    <li class="list-group-item" style="font-size: small; padding: 0;">Nothing's
                                        processed yet</li>
                                </ul>
                            </div>

                        </div>
                        <div class="tab-pane fade" id="nav-mempool" role="tabpanel" aria-labelledby="nav-mempool-tab">
                            <div v-if="pooledTransactions.length > 0">
                                <ul class="list-group" v-for="transaction in pooledTransactions">
                                    <li class="list-group-item"
                                        style="font-size: small; padding: 0; background-color: chartreuse;">
                                        {{ transaction.transactionBody.amount }} from
                                        0x{{ transaction.transactionBody.sourceAddress.toString(16).slice(0,8) }}... to
                                        0x{{ transaction.transactionBody.targetAddress.toString(16).slice(0,8) }}...</li>
                                </ul>
                            </div>
                            <div v-else>
                                <ul class="list-group">
                                    <li class="list-group-item" style="font-size: small; padding: 0;">Nothing in
                                        transaction pool
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="nav-blockchain" role="tabpanel"
                            aria-labelledby="nav-blockchain-tab">

                            <div v-if="leadingBlocks.length > 0">
                                <!-- TODO: leadingBlocks[0] -->
                                <h6>
                                    Block {{leadingBlocks[0].block.blockBody.height}}
                                </h6>
                                <div style="text-overflow: ellipsis; overflow: hidden">
                                    Hash: {{leadingBlocks[0].block.blockHash.toString()}}
                                </div>
                                <ul class="list-group" v-for="transaction in leadingBlocks[0].block.blockBody.transactions">
                                    <li class="list-group-item"
                                        style="font-size: small; padding: 0; background-color: chartreuse;">
                                        <div v-if="transaction.transactionBody.sourceAddress">
                                            {{ transaction.transactionBody.amount }} token(s) transfer from
                                            0x{{ transaction.transactionBody.sourceAddress.toString(16).slice(0,8) }}... to
                                            0x{{ transaction.transactionBody.targetAddress.toString(16).slice(0,8) }}...
                                        </div>
                                        <div v-else>
                                            {{ transaction.transactionBody.amount }} token(s) generation for
                                            0x{{ transaction.transactionBody.targetAddress.toString(16).slice(0,8) }}...
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <div v-else>
                                <ul class="list-group">
                                    <li class="list-group-item" style="font-size: small; padding: 0;">Blockchain not
                                        installed yet
                                    </li>
                                </ul>
                            </div>

                        </div>
                    </div>






                    <!-- <div v-if="network.selectedNode.eventProcessor.events.length > 0">
                    {{ network.selectedNode.eventProcessor.events[0] }}
                    </div> -->
                </div>
                <div v-else>
                    <h3 class="mt-4 mb-4">
                        Welcome to Vichain!
                    </h3>

                    <nav>
                        <div class="nav nav-tabs" id="nav-tab" role="tablist">
                            <button class="nav-link active" id="nav-start-tab" data-bs-toggle="tab"
                                data-bs-target="#nav-start" type="button" role="tab" aria-controls="nav-home"
                                aria-selected="true">Start</button>
                            <button class="nav-link" id="nav-blockchain-overview-tab" data-bs-toggle="tab"
                                data-bs-target="#nav-blockchain-overview" type="button" role="tab"
                                aria-controls="nav-blockchain-overview" aria-selected="false">Blockchain</button>
                        </div>
                    </nav>

                    <div class="tab-content" id="nav-tabContent">
                        <div class="tab-pane fade show active overflow-scroll" style="max-height: fit-content;"
                            id="nav-start" role="tabpanel" aria-labelledby="nav-start-tab">

                            <div class="mt-4 mb-3">
                                <h6 class="mb-0">
                                    <button type="button" class="btn btn-info disabled btn-sm">Left click</button> with
                                    <button type="button" class="btn btn-info disabled btn-sm">Ctrl</button> to create
                                    new
                                    node
                                </h6>
                                <div>
                                    or
                                </div>
                                <div>
                                    <button type="button" class="btn btn-primary btn-sm"
                                        @click="createRandomNode">Create random
                                        node</button>
                                </div>
                            </div>

                            <h6 class="mt-4 mb-3">
                                <button type="button" class="btn btn-info disabled btn-sm">Left click</button> on a node
                                with
                                <button type="button" class="btn btn-info disabled btn-sm">Shift</button> holded and
                                drag to
                                another node to create link between the nodes manually (links are created also
                                automatically)
                            </h6>

                            <h6 class="mt-4 mb-3">
                                <button type="button" class="btn btn-info disabled btn-sm">Left click</button> on a node
                                to
                                select it
                            </h6>

                            <h6 class="mt-4 mb-3">
                                Hold <button type="button" class="btn btn-info disabled btn-sm">Left click</button> on a
                                node
                                and
                                drag to move it
                            </h6>

                            <h6 class="mt-4 mb-3">
                                Press <button type="button" class="btn btn-info disabled btn-sm">Space</button> to
                                (un)pause
                                the simulation
                            </h6>

                            <h6 class="mt-4 mb-3">
                                And finally <button type="button" class="btn btn-primary btn-sm"
                                    @click="installBlockchain">Install Proof-of-Burn
                                    blockchain on created nodes</button>
                            </h6>
                        </div>

                        <div class="tab-pane fade" id="nav-blockchain-overview" role="tabpanel"
                            aria-labelledby="nav-blockchain-overview-tab">
                            <button type="button" class="btn btn-primary btn-sm" @click="installBlockchain">Install
                                Proof-of-Burn
                                blockchain on created nodes</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="row">
            <div class="col-4" style="align-self: center;">
                <div class="btn-group dropup mx-auto" style="float: left;">
                    <button type="button" class="btn btn-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        Visibility
                    </button>
                    <ul class="dropdown-menu">
                        <li
                            v-for="event in Object.keys(networkManager.settings.events).filter(event => networkManager.settings.events[event].isVisible !== null)">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault"
                                    v-model="networkManager.settings.events[event].isVisible">
                                <label class="form-check-label" for="flexSwitchCheckDefault"
                                    style="font-size: x-small;">{{ getTranslation(event) }} events</label>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-4">
                <!-- <h3 v-if="network.currentFps">{{ network.currentFps }} FPS</h3> -->
                <h3>{{ (networkManager.network.timer.currentTimestamp/1000).toFixed(1) }}s</h3>
            </div>
            <div class="col-4" style="text-align: right;">
                <p class="font-monospace" style="font-size: small; margin: 0;">created by Jan Jankowicz</p>
                <a class="font-monospace" style="font-size: x-small;" href="https://github.com/UniJanJan/vichain">GitHub
                    repository</a>
            </div>
        </div>
    </div>
</body>

<script src="https://code.jquery.com/jquery-3.7.1.slim.min.js"
    integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://unpkg.com/vuex@4.0.0/dist/vuex.global.js"></script>
<script src="https://peterolson.github.io/BigInteger.js/BigInteger.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"
    integrity="sha512-a+SUDuwNzXDvz4XrIcXHuCf089/iJAoN4lmrXJg18XnduKK6YlDHNRalv4yd1N40OKI80tFidF+rqTFKGPoWFQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type="module" src="./src/index.js"></script>

</html>